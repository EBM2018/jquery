<script src="jquery-3.3.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style>
    #contenu * {
        padding: 3px;
        margin: 3px;
        border: none;
        resize: none;
    }

    #contenu textarea {
        border: 1px solid black;
    }

    #contenu p:hover {
        border: 1px dashed black;
        cursor: pointer;
    }

    .btnPlus {
        display: inline;
    }

    .red * {
        color: red;
    }

    .blue * {
        color: blue;
    }
</style>


<script>
    // TODO : préparer un "composant" boutonPlus
    // qui insère des P. en position haute ou basse
    // suivant une méta-donnée "position"
    $(document).ready(function () {
        var i = 0;
        $.getJSON("data.php?action=getP", function (data) {
            for (i in data.paragraphes) {
                $("#contenu").append('<div id=' + data.paragraphes[i].id + '><p class="contenu">' + data.paragraphes[i].contenu + '</p></div>');
            }
        });
        $(document).on("click", "#contenu .contenu", function () {
            // fonction appelee lors d'un clic sur un P
            // dans le div de contenu
            var contenu = $(this).html(); // recup contenu
            var jTa = $("<textarea>")
                .val(contenu)
                .data("contenuInitial", contenu);
            // prépa txtarea
            // AJOUT d'une méta-donnée
            $(this).replaceWith(jTa); // insertion txtarea
            jTa.focus(); // .select();
        });
        $(document).on("keydown",
            "#contenu textarea",
            function (contexte) {
                // quelle est la touche appuyée ??
                // en JQuery, tous les gestionnaires d'evenements
                // sont destinataires d'un objet event en param.
                // prop code ascii de la touche : code vaudra "Enter"
                if (contexte.which != 13) return;
                var contenu = $(this).val(); // recup contenu
                if (contenu === '') return false;
                var idRequest = $(this).parent().attr("id");
                var jPar = $("<p class='contenu'>").html(contenu); // prépa P
                $(this).replaceWith(jPar); // insertion P
                $.getJSON("data.php?action=updateP&id=" + idRequest + "&contenu=" + contenu);
            });
        /*$(document).on("click",
            ".add",
            function () {
                let numItems = $('.contenu').length;
                $("#contenu").append('<div><textarea class=""></textarea></div>');
                $(document).on("keydown",
                    "#contenu textarea",
                    function (contexte) {
                        // quelle est la touche appuyée ??
                        // en JQuery, tous les gestionnaires d'evenements
                        // sont destinataires d'un objet event en param.
                        // prop code ascii de la touche : code vaudra "Enter"
                        if (contexte.which != 13) return;
                        var contenu = $(".add").val(); // recup contenu
                        if (contenu === '') return false;
                        var jPar = $("<p class='contenu'>").html(contenu); // prépa P
                        $(this).replaceWith(jPar); // insertion P
                        $.getJSON("data.php?action=addP&order=" + numItems + 1 + "&contenu=" + contenu);
                    });
            });*/

        $(document).on("click",
            ".add",
            function () {
                // récupération du nombre de paragraphes
                let numItems = $('.contenu').length;
                order = parseInt(numItems) + 1;
                //  gestionnaire d'évnt sur click sur btn +
                // ici, $(this) dénote le bouton cliqué
                // $(this).next() dénote donc le champ d'entrée texte
                // $(this).next().val() est son contenu

                // Récupération du contenu du champ texte
                var contenu = 'Nouveau paragraphe';
                $(this).next().val(""); // puis on le vide
                var Jdiv = $('<div class="ajout"><p class="contenu">' + contenu + '</p></div>');

                // on insère un nouveau P avec ce contenu
                $("#contenu").append(Jdiv);
                $.getJSON("data.php?action=addP&ordre=" + order + "&contenu=" + contenu, function (data) {
                   $(".ajout").attr('id', data.id);
                });
            });

    });
</script>

<body>

<div id="contenu">
    <button class="add">ajouter</button>
</div>

</body>