<link rel="stylesheet" href="jquery-ui-1.12.1/jquery-ui.css">
<script src="jquery-3.3.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="jquery-ui-1.12.1/jquery-ui.js"></script>

<style>
    #contenu * {
        padding: 3px;
        margin: 3px;
        resize: none;
        border: none;
        font-family: Arial;
        font-size: 20px;
    }

    #contenu textarea {
        border: 1px solid black;
    }

    #contenu p:hover {
        border: 1px dashed black;
        cursor: pointer;
    }
    .contenu {
        float: left;
    }
    .croix {
        height: 25px;
        width: 25px;
    }
    .croix:hover {
        cursor: pointer;
    }
    .dragdrop {
        height: 25px;
        width: 25px;
    }
    .dragdrop:hover {
        cursor: pointer;
    }
</style>


<script>
    $(document).ready(function () {
        var i = 0;
        $.getJSON("data.php?action=getP", function (data) {
            for (i in data.paragraphes) {
                $("#contenu").append('<div id=' + data.paragraphes[i].id + '><img src="updown.png" class="dragdrop" />  <p class="contenu">' + data.paragraphes[i].contenu + '</p><img src="croix.png" class="croix" /></div>');
            }
        });
        $(document).on("click", "#contenu .contenu", function () {
            // fonction appelee lors d'un clic sur un P
            // dans le div de contenu
            var contenu = $(this).html(); // recup contenu
            var jTa = $("<textarea>")
                .val(contenu)
                .data("contenuInitial", contenu);
            // prépa txtarea
            // AJOUT d'une méta-donnée
            $(this).replaceWith(jTa); // insertion txtarea
            jTa.focus(); // .select();
        });
        $(document).on("keydown",
            "#contenu textarea",
            function (contexte) {
                // quelle est la touche appuyée ??
                // en JQuery, tous les gestionnaires d'evenements
                // sont destinataires d'un objet event en param.
                // prop code ascii de la touche : code vaudra "Enter"
                console.log(contexte.which);
                if (contexte.which != 13) return;
                var contenu = $(this).val(); // recup contenu
                if (contenu === '') return false;
                var idRequest = $(this).parent().attr("id"); // attribut parent
                var jPar = $("<p class='contenu'>").html(contenu); // prépa P
                $(this).replaceWith(jPar); // insertion P
                console.log("data.php?action=updateP?id=" + idRequest + "&contenu=" + contenu);
                $.getJSON("data.php?action=updateP&id=" + idRequest + "&contenu=" + contenu);
            });
        // ESC
        $(document).keyup(function(contexte){
            if (contexte.which != 27) return;

            // parcours de tous les textarea
            $("#contenu textarea").each(function(){
                // $(this) dénote le txtarea en cours de parcours
                // permet de récupérer le contenu initial
                var contenu = $(this).data("contenuInitial") ;
                var jPar = $("<p class='contenu'>").html(contenu); // prépa P
                $(this).replaceWith(jPar); // insertion P
            });

        });

        // suppression P
        $(document).on("click", ".croix", function () {
            // fonction appelee lors d'un clic sur la croix
            // dans le div de contenu
            var idRequest = $(this).parent().attr("id"); // attribut parent
            console.log(idRequest);
            $("#" + idRequest).remove();
            $.getJSON("data.php?action=delP&id=" + idRequest);
        });
        $("#contenu").sortable({
            update: function( event, ui ) {

            }
        }
        });
    </script>

<body>

<div id="contenu">

</div>

</body>